<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top View Shooting Game</title>
    <style>
        canvas {
            display: block;
            margin: 0 auto;
            background-color: black;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const player = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            width: 20,
            height: 20,
            color: 'blue'
        };

        const playerLaser = {
            x: 0,
            y: 0,
            width: 5,
            height: 20,
            color: 'blue',
            active: false
        };

        const enemyCount = 5;
        const enemies = [];
        const enemyLasers = [];

        const specialEnemy = {
            x: canvas.width / 2,
            y: 50,
            width: 30,
            height: 30,
            color: 'green',
            speedX: 1,
            speedY: 1,
            active: false,
            health: 5
        };

        const specialEnemyProjectiles = [];
        const specialProjectileRadius = 8;

        for (let i = 0; i < 10; i++) {
            specialEnemyProjectiles.push({
                x: 0,
                y: 0,
                radius: specialProjectileRadius,
                speedX: Math.cos((i / 10) * Math.PI * 2) * 2,
                speedY: Math.sin((i / 10) * Math.PI * 2) * 2,
                color: 'green',
                active: false
            });
        }

        let commonEnemyKills = 0;

        for (let i = 0; i < enemyCount; i++) {
            enemies.push(createEnemy());
            enemyLasers.push({
                x: 0,
                y: 0,
                width: 5,
                height: 20,
                color: 'red',
                speedX: 0,
                speedY: 0,
                active: true
            });
        }

        const item = {
            x: 0,
            y: 0,
            radius: 10,
            color: 'pink',
            active: false
        };

        let playerLaserSpeed = 10;

        canvas.addEventListener('mousemove', (e) => {
            player.x = e.clientX - canvas.offsetLeft - player.width / 2;
            player.y = e.clientY - canvas.offsetTop - player.height / 2;
        });

        canvas.addEventListener('click', () => {
            if (!playerLaser.active) {
                playerLaser.active = true;
                playerLaser.x = player.x + player.width / 2 - playerLaser.width / 2;
                playerLaser.y = player.y;
            }
        });

        function createEnemy() {
            return {
                x: Math.random() * (canvas.width - 30),
                y: Math.random() * (canvas.height / 2 - 30),
                width: 20,
                height: 20,
                color: 'red',
                speedX: (Math.random() - 0.5) * 4,
                speedY: (Math.random() - 0.5) * 4
            };
        }

        function isColliding(rect1, rect2) {
            return (
                rect1.x < rect2.x + rect2.width &&
                rect1.x + rect1.width > rect2.x &&
                rect1.y < rect2.y + rect2.height &&
                rect1.y + rect1.height > rect2.y
            );
        }

        function isCollidingCircleRect(circle, rect) {
            const closestX = Math.max(rect.x, Math.min(circle.x, rect.x + rect.width));
            const closestY = Math.max(rect.y, Math.min(circle.y, rect.y + rect.height));
            const dx = circle.x - closestX;
            const dy = circle.y - closestY;
            return (dx * dx + dy * dy) < (circle.radius * circle.radius);
        }

        function drawRect(rect, color) {
            ctx.fillStyle = color;
            ctx.fillRect(rect.x, rect.y, rect.width, rect.height);
        }

        function drawCircle(circle, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(circle.x, circle.y, circle.radius, 0, Math.PI * 2, false);
            ctx.fill();
        }

        function update() {
            if (playerLaser.active) {
                playerLaser.y -= playerLaserSpeed;
                if (playerLaser.y < 0) {
                    playerLaser.active = false;
                }
            }

            for (let i = 0; i < enemies.length; i++) {
                const enemy = enemies[i];
                const enemyLaser = enemyLasers[i];

                enemy.x += enemy.speedX;
                enemy.y += enemy.speedY;

                if (enemy.x < 0 || enemy.x + enemy.width > canvas.width) {
                    enemy.speedX = -enemy.speedX;
                }

                if (enemy.y < 0 || enemy.y + enemy.height > canvas.height) {
                    enemy.speedY = -enemy.speedY;
                }

                if (!enemyLaser.active) {
                    const dx = player.x + player.width / 2 - (enemy.x + enemy.width / 2);
                    const dy = player.y + player.height / 2 - (enemy.y + enemy.height / 2);
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    enemyLaser.speedX = (dx / distance) * 5;
                    enemyLaser.speedY = (dy / distance) * 5;

                    enemyLaser.active = true;
                    enemyLaser.x = enemy.x + enemy.width / 2 - enemyLaser.width / 2;
                    enemyLaser.y = enemy.y + enemy.height;
                } else {
                    enemyLaser.x += enemyLaser.speedX;
                    enemyLaser.y += enemyLaser.speedY;

                    if (enemyLaser.y < 0 || enemyLaser.y + enemyLaser.height > canvas.height) {
                        enemyLaser.active = false;
                    }
                }

                if (isColliding(playerLaser, enemy)) {
                    commonEnemyKills++;
                    enemies.splice(i, 1);
                    enemies.push(createEnemy());
                    enemyLasers.splice(i, 1);
                    enemyLasers.push({
                        x: 0,
                        y: 0,
                        width: 5,
                        height: 20,
                        color: 'red',
                        speedX: 0,
                        speedY: 0,
                        active: false
                    });
                    playerLaser.active = false;

                    if (Math.random() < 0.3) {
                        item.active = true;
                        item.x = enemy.x + enemy.width / 2;
                        item.y = enemy.y + enemy.height;
                    }

                    if (commonEnemyKills % 10 === 0) {
                        specialEnemy.active = true;
                        specialEnemy.health = 10;
                        specialEnemy.x = Math.random() * (canvas.width - specialEnemy.width);
                        specialEnemy.y = 50;
                        console.log('New Special Enemy Created');
                    }
                }


                if (isColliding(enemies[i], player)) {
                    document.location.reload();
                }

                if (isColliding(enemyLaser, player)) {
                    document.location.reload();
                }
            }

            if (specialEnemy.active && isColliding(specialEnemy, player)) {
                document.location.reload();
            }

            if (specialEnemy.active) {
                specialEnemy.x += specialEnemy.speedX;
                specialEnemy.y += specialEnemy.speedY;

                if (specialEnemy.x < 0 || specialEnemy.x + specialEnemy.width > canvas.width) {
                    specialEnemy.speedX = -specialEnemy.speedX;
                }

                if (specialEnemy.y < 0 || specialEnemy.y + specialEnemy.height > canvas.height) {
                    specialEnemy.speedY = -specialEnemy.speedY;
                }

                for (const projectile of specialEnemyProjectiles) {
                    if (!projectile.active) {
                        projectile.active = true;
                        projectile.x = specialEnemy.x + specialEnemy.width / 2;
                        projectile.y = specialEnemy.y + specialEnemy.height / 2;
                    } else {
                        projectile.x += projectile.speedX;
                        projectile.y += projectile.speedY;

                        if (projectile.x + projectile.radius > canvas.width ||
                            projectile.x - projectile.radius < 0) {
                            projectile.speedX = -projectile.speedX;
                        }

                        if (projectile.y + projectile.radius > canvas.height ||
                            projectile.y - projectile.radius < 0) {
                            projectile.speedY = -projectile.speedY;
                        }
                    }

                    if (isCollidingCircleRect(projectile, player)) {
                        document.location.reload();
                    }
                }

                if (playerLaser.active && isColliding(playerLaser, specialEnemy)) {
                    specialEnemy.health -= 1;
                    playerLaser.active = false;

                    if (specialEnemy.health === 0) {
                        specialEnemy.active = false;
                        specialEnemyProjectiles.forEach(projectile => {
                            projectile.active = false;
                        });
                    }
                }
            }

            if (item.active) {
                if (isCollidingCircleRect(item, player)) {
                    item.active = false;
                    playerLaserSpeed *= 1.5;
                } else {
                    item.y += 2;
                    if (item.y > canvas.height) {
                        item.active = false;
                    }
                }
            }

            draw();
            requestAnimationFrame(update);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawRect(player, player.color);
            if (playerLaser.active) {
                drawRect(playerLaser, playerLaser.color);
            }

            enemies.forEach(enemy => {
                drawRect(enemy, enemy.color);
            });

            enemyLasers.forEach(enemyLaser => {
                drawRect(enemyLaser, enemyLaser.color);
            });

            if (specialEnemy.active) {
                drawRect(specialEnemy, specialEnemy.color);
                specialEnemyProjectiles.forEach(projectile => {
                    if (projectile.active) {
                        drawCircle(projectile, projectile.color);
                    }
                });
            }

            if (item.active) {
                drawCircle(item, item.color);
            }
        }

        update();
    </script>
</body>
</html>
